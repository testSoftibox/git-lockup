#tmp -*- python -*-

#tmp This template is used by the git-assure tool to create ./setup-assure .
#tmp It includes an encoded copy of git-assure. When ./setup-assure is
#tmp run by a client (someone who has just cloned the repo and wants to begin
#tmp protecting their fetches), ./setup-assure will use its encoded copy to
#tmp create .git/git-assure, and then read the branch/pubkey list from the
#tmp neighboring assure.config file to modify .git/config

# Welcome to git-assure!

# By running this program, your git checkout will be configured to check
# per-revision signatures every time you fetch new changes. This will
# ensure that you only get changes from the upstream author of this
# project, preventing unauthorized commits injected at any intermediate
# repositories or hosting providers.

# we need make_executable() from common.py
#<-- common

# this is filled in by "git-assure setup-publish", with a copy of git-assure
git_assure_b64 = """
GIT_ASSURE_B64
"""

# install .git/git-assure
assert os.path.isdir(".git")
tool = os.path.abspath(".git/git-assure")
f = open(tool, "wb")
f.write(base64.b64decode(git_assure_b64))
f.close()
make_executable(tool)

import os,sys
os.execv(sys.executable, [sys.executable, tool, "setup-client"])
