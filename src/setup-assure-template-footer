#tmp -*- python -*-

# footer here, ready to do stuff

#<-- common

assure_tool_b64 = """
#<-- assure_tool-b64
"""

#<-- setup-client

# install .git/assure-tool
assert os.path.isdir(".git")
tool = ".git/assure-tool"
f = open(tool, "wb")
f.write(base64.b64decode(assure_tool_b64))
f.close()
make_executable(tool)

from ConfigParser import SafeConfigParser
config = SafeConfigParser()
config.readfp(open("assure.config"))

for branch,keys in config.items("branches"):
    remote = get_config("branch.%s.remote" % branch)
    assert remote
    for key in keys.split():
        setup_client(remote, branch, key)
